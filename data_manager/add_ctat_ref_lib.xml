<tool id="ctat_genome_ref_lib_data_manager" 
    name="CTAT Genome Reference Library Data Manager" 
    version="1.0.0" tool_type="manage_data">
    <description>Retrieve, and/or specify the location of, a CTAT Genome Reference Library. 
    </description>
    <requirements>
        <requirement type="package" version="2.7">python</requirement>
        <requirement type="package" version="0.5.0">fusion-filter</requirement>
        <!-- gmap-fusion used to be required in order to process downloaded libraries 
             to create all of the required files and indexes. It includes gmap
             and FusionFilter, programs from both of which are needed.
             Now there is a bioconda FusionFilter recipe. Lets try using that instead.
        <requirement type="package" version="0.3.0">gmap-fusion</requirement>
        -->
    </requirements>
    <command detect_errors="default">
        <![CDATA[
        python $__tool_directory__/add_ctat_ref_lib.py 
            --genome_name "${genome_name}" 
            --destination_path "${destination}" 
            --output_filename "${out_file}" 
            #if str(${download}) == "true":
                --download_file "${filename}" 
            #end if
            #if str(${force_download}) == "true":
                --force_download 
            #end if
            #if str(${rebuild}) == "true":
                --build 
            #end if
            #if str(${gmap_build}) == "true":
                --gmap_build 
            #end if
        ]]>
    </command>
    <inputs>
        <!-- The following are left in here, just as examples of various ways of doing options.
            <param name="force_download" type="boolean" checked="false"
                truevalue="- -force_download" falsevalue="" label="Force New Download? (yes/no)" />
            <param name="download" type="select" label="Need to Download?">
                <option value="single" selected="true">Single Dataset</option>
                <option value="paired_collection">Paired Collection</option>
            <when value="paired_collection">
                 <param name="fastq_input" format="fastqsanger" type="data_collection" collection_type="paired" label="Select dataset pair" help="Specify paired dataset collection containing paired reads"/>
            </when>
        -->
        <conditional name="download_question">
            <param name="download" type="boolean" checked="false" label="Need to Download?" />
            </param>
            <when value="true">
                <!-- The use of a code block to get dynamic options is now deprecated and discouraged.
                     I am still using it here. The only other way I can think of to do this is to
                     create another data_manager that gets the list of files and puts them into a
                     data_table, that is then used to get the filenames. That would require the admin
                     to first run the data_manager that builds the filename data_table before running
                     this data_manager.
                -->
                <param name="filename" type="select" label="Select File" display="radio" 
                    dynamic_options="get_ctat_genome_filenames()" help="Select a CTAT Genome Reference Library to Download." />
                <param name="force_download" type="boolean" checked="false" label="Force New Download?" />
            </when>
        </conditional>

        <param name="genome_name" type="text" label="Reference Genome name" />
        <param name="destination" type="text" label="Local Destination (full path)" />
        <param name="rebuild" type="boolean" checked="false" label="Force rebuild of Library?" />
        <param name="gmap_build" type="boolean" checked="false" label="Do a gmap_build on the Library?" />
    </inputs>
    <outputs>
        <data name="out_file" format="data_manager_json" />
    </outputs>
    <help>
        Retrieve, and/or specify the location of, a CTAT Genome Reference Library.
        When download is true, the files at https://data.broadinstitute.org/Trinity/CTAT_RESOURCE_LIB/
        are used as selectors for the user to choose among.
        Specify the Full Path of the location where the CTAT Reference Library should be placed.
        You will need approximately 60GB of space for this library.
        If you already have the library, specify the full path of the location where it exists and leave the download box unchecked.
        The Reference Genome name may be left empty if downloading. The name will be used as the selector text of the entry in the data table.
        For more information on CTAT Genome Reference Libraries, see <a http="https://github.com/FusionFilter/FusionFilter/wiki">FusionFilter</a>
    </help>
    <code file="add_ctat_ref_lib.py" />
</tool>
